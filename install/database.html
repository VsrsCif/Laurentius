<div class="main">
    <article class='content'>

    


        <h1 id="install/database:db-dialect">Hibernate dialect</h1>
        Aplikacija Laurentius za do podatkovne baze uporablja knjižnice hibernate. Zato 
        je pred prvim zgonom aplikacije potrebno določiti hibernate dialekt, ki ustreza
        nastavljeni bazi. Seznam vseh dialektov in baz, ki jih podpira hibernate je objavljen
        na tej povezavi: <a href="https://docs.jboss.org/hibernate/orm/5.2/javadocs/org/hibernate/dialect/package-summary.html">hibernate dialekti</a>.
        , ki je odvisen od uporabljene baze.

        <h1 id="install/database:db">Dostop do baze (SQL - DMBS)</h1>

        Za dostop do podatkovnih zbirk aplikacija uporablja knjižnico: <a href="http://hibernate.org/">hibernate (5.x)</a>.
        Izbira baze je tako omejena na seznam baz, ki jih podpira hibernate.  Pred prvim zgonom aplikacije 
        potrebno določiti hibernate dialekt, ki ustreza uporabljeni bazi. Seznam vseh dialektov in baz, ki jih podpira hibernate je objavljen
        na tej povezavi: <a href="https://docs.jboss.org/hibernate/orm/5.2/javadocs/org/hibernate/dialect/package-summary.html">hibernate dialekti</a>.
        <br />
        ,   Dialekt se nastavi v datoteki:
        <pre><code>${WILDFLY_HOME}/bin/laurentius-demo.(bat|sh)</code></pre>
        Kjer se nastavi parameter:  <b>DB_DIALECT</b>.<br /><br /> 


        (Aplikacija je testirana na bazah: h2, postgresql in oracle 11.) Izbira sitema SQL podatkovne baze
        se tako izvede v nastavitvah aplikacijskega strežnika. <br /><br /> 

        Parametri dostopa do podatkovne baze se nastavi v nastavitvah aplikacijskega strežnika:
        <pre><code>${WILDFLY_HOME}/configuration/standalone-laurentius.xml</code></pre>

        Aplikacija Laurentis do baze dostopa preko konfiguracije z nazivom "dsEBMS_SED", zato je potrebno 
        v razdelku <code>&lt;subsystem xmlns="urn:jboss:domain:datasources:4.0"></code>
        Določiti dostop do podatkovne zbirke z 'jndi-name="java:/dsEBMS_SED"'


        <h2 id="install/database:db-h2">H2 podatkovna baza</h2>
        Osnovna namestitev aplikacijskega strežnika že vsebuje vse potrebne knjižnice
        za uporabo h2 baze. Zato je potrebno v konfiguraciji samo dodati "datasource" značko
        <code>&lt;datasource jndi-name="java:/dsEBMS_SED"</code>
        <br /> <br />
        Spodnji primer uporablja "datotečno bazo h2" v datoteki "[WILDLFLY_HOME]/standalone/data/laurentius-db" : 
        <pre><code>&lt;subsystem xmlns="urn:jboss:domain:datasources:4.0">
    &lt;datasources>
        &lt;datasource jndi-name="java:jboss/datasources/ExampleDS" pool-name="ExampleDS" enabled="true" use-java-context="true">
            &lt;connection-url>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE&lt;/connection-url>
            &lt;driver>h2&lt;/driver>
            &lt;security>
                &lt;user-name>sa&lt;/user-name>
                &lt;password>sa&lt;/password>
            &lt;/security>
        &lt;/datasource>
        &lt;datasource jndi-name="java:/dsEBMS_SED" pool-name="ebMSSEDPool" enabled="true" statistics-enabled="true">
            &lt;connection-url>jdbc:h2:file:${jboss.home.dir}/standalone/data/laurentius-db;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=TRUE&lt;/connection-url>
            &lt;driver>h2&lt;/driver>
            &lt;pool>
                &lt;min-pool-size>1&lt;/min-pool-size>
                &lt;max-pool-size>1&lt;/max-pool-size>
                &lt;prefill>true&lt;/prefill>
            &lt;/pool>
            &lt;security>
                &lt;user-name>laurentius&lt;/user-name>
                &lt;password>laurentius&lt;/password>
            &lt;/security>
        &lt;/datasource>
        &lt;drivers>
            &lt;driver name="h2" module="com.h2database.h2">
                &lt;xa-datasource-class>org.h2.jdbcx.JdbcDataSource&lt;/xa-datasource-class>
            &lt;/driver>
        &lt;/drivers>
    &lt;/datasources>
&lt;/subsystem>
            </code></pre>

        <h2 id="install/database:db-postgres">Postgres podatkova baza</h2>
        Za uporabo postgres podatkovne baze, je potrebno najprej namestiti 
        primerne JDBC gonilnike, ki so dosegljivi na spletni strani „https://jdbc.postgresql.org/download.html“.
        <br />
        Gonilnik se doda kot zunanja knjižnica (mudul) tako da se naredi mapa:
        <code>[WILDFLY_HOME]/modules/org/postgres/main</code>
        ter se vanj namesti gonilnik postgresql-[db.version].jdbcXX.jar
        Hkrati se v mapi izdela datoteka z opisom knjižnice <code>module.xml</code>
        z vsebino:
        <pre><code>&lt;?xml version="1.0" ?>
&lt;module xmlns="urn:jboss:module:1.1" name="org.postgres">
    &lt;resources>
        &lt;resource-root path="postgresql-[db.version].jdbcXX.jar"/>
    &lt;/resources>
    &lt;dependencies>
        &lt;module name="javax.api"/>
        &lt;module name="javax.transaction.api"/>
    &lt;/dependencies>
&lt;/module></code></pre><br /><br />

        Novi gonilnik se v konfiguracijski datoteki 'standalone-laurentius.xml' vključi tako, da se
        doda v razdelku <code>subsystem@xmlns="urn:jboss:domain:datasources:4.0"/drivers</code> nov razdelek 
        "driver"
        <pre><code>&lt;driver name="postgres" module="org.postgres">
    &lt;driver-class>org.postgresql.Driver&lt;/driver-class>
&lt;/driver>
</code></pre>
        <br /><br />
        Dostop do baze se doda tako kot prikazujejo spodnje nastavitve. Za lastne nastavitve 
        popravi: connection-url, user-name in password.
        <pre><code>&lt;subsystem xmlns="urn:jboss:domain:datasources:4.0">
    &lt;datasources>
        &lt;datasource jndi-name="java:jboss/datasources/ExampleDS" pool-name="ExampleDS" enabled="true" use-java-context="true">
            &lt;connection-url>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE&lt;/connection-url>
            &lt;driver>h2&lt;/driver>
            &lt;security>
                &lt;user-name>sa&lt;/user-name>
                &lt;password>sa&lt;/password>
            &lt;/security>
        &lt;/datasource>
        &lt;datasource jndi-name="java:/dsEBMS_SED" pool-name="ebMSSEDPool" enabled="true" statistics-enabled="true">
            &lt;connection-url>jdbc:postgresql://localhost/db_laurentius&lt;/connection-url>
            &lt;driver>postgres&lt;/driver>
                        &lt;pool>
                &lt;min-pool-size>1&lt;/min-pool-size>
                &lt;max-pool-size>5&lt;/max-pool-size>
                &lt;prefill>true&lt;/prefill>
            &lt;/pool>
            &lt;security>
                &lt;user-name>lau&lt;/user-name>
                &lt;password>lau1234t&lt;/password>
            &lt;/security>
        &lt;/datasource>
        &lt;drivers>
            &lt;driver name="h2" module="com.h2database.h2">
                &lt;xa-datasource-class>org.h2.jdbcx.JdbcDataSource&lt;/xa-datasource-class>
            &lt;/driver>
            &lt;driver name="postgres" module="org.postgres">
                &lt;driver-class>org.postgresql.Driver&lt;/driver-class>
            &lt;/driver>
        &lt;/drivers>
    &lt;/datasources>
&lt;/subsystem>

</code></pre>


        <h2 id="install/database:db-oracle">Oracle podatkovna baza</h2>

        Za uporabo oracle podatkovne baze, je potrebno najprej namestiti 
        primerne JDBC gonilnike, ki so dosegljivi na  spletni strani „http://www.oracle.com“.
        <br />
        Gonilnik se doda kot zunanja knjižnica (mudul) tako da se naredi mapa:
        <code>[WILDFLY_HOME]/modules/com/oracle/jdbc/main</code>
        ter se vanj posname: ojdbc[db.version].jar in orai18n[db.version].jar
        Hkrati se v mapi doda datoteka z opisom modula <code>module.xml</code>
        z vsebino:
        <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;module xmlns="urn:jboss:module:1.1" name="com.oracle.jdbc">
  &lt;resources>
    &lt;resource-root path="ojdbc[db.version].jar"/>
  &lt;resource-root path="orai18n[db.version].jar"/>
  &lt;/resources>
  &lt;dependencies>
    &lt;module name="javax.api"/>
    &lt;module name="javax.transaction.api"/>
    &lt;module name="javax.servlet.api" optional="true"/>  
  &lt;/dependencies>
&lt;/module></code></pre><br /><br />

        Novi gonilnik se v konfiguracijski datoteki 'standalone-laurentius.xml' vključi tako, da se
        doda v razdelku <code>subsystem@xmlns="urn:jboss:domain:datasources:4.0"/drivers</code> nov razdelek 
        "driver"
        <pre><code> &lt;driver name="orcl" module="com.oracle.jdbc">
      &lt;xa-datasource-class>oracle.jdbc.driver.OracleDriver&lt;/xa-datasource-class>
    &lt;/driver>
</code></pre>
        <br /><br />
        Dostop do baze se doda tako kot prikazujejo spodnje nastavitve. Za lastne nastavitve 
        popravi: connection-url, user-name in password.
        <pre><code>&lt;datasources>
  &lt;datasource jndi-name="java:jboss/datasources/ExampleDS" pool-name="ExampleDS" enabled="true" use-java-context="true">
    &lt;connection-url>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE&lt;/connection-url>
    &lt;driver>h2&lt;/driver>
    &lt;security>
      &lt;user-name>sa&lt;/user-name>
      &lt;password>sa&lt;/password>
    &lt;/security>
  &lt;/datasource>
  &lt;datasource jndi-name="java:/dsEBMS_SED" pool-name="ebMSSEDPool" enabled="true" use-java-context="true">
    &lt;connection-url>jdbc:oracle:thin:@my.address.com:1521:sidl&lt;/connection-url>
    &lt;driver>orcl&lt;/driver>
    &lt;pool>
      &lt;min-pool-size>3&lt;/min-pool-size>
      &lt;max-pool-size>5&lt;/max-pool-size>
      &lt;prefill>true&lt;/prefill>
    &lt;/pool>
    &lt;security>
      &lt;user-name>lau&lt;/user-name>
      &lt;password>lau1234&lt;/password>
    &lt;/security>
  &lt;/datasource>
  &lt;drivers>
    &lt;driver name="h2" module="com.h2database.h2">
      &lt;xa-datasource-class>org.h2.jdbcx.JdbcDataSource&lt;/xa-datasource-class>
    &lt;/driver>
    &lt;driver name="orcl" module="com.oracle.jdbc">
      &lt;xa-datasource-class>oracle.jdbc.driver.OracleDriver&lt;/xa-datasource-class>
    &lt;/driver>
  &lt;/drivers>
&lt;/datasources></code></pre>



        <h2 id="install/database:db-mssql">Microsoft SQL Server</h2>

        Za uporabo oracle podatkovne baze, je potrebno najprej namestiti 
        primerne JDBC gonilnike, ki so dosegljivi na  spletni strani <br />
        "https://docs.microsoft.com/en-us/sql/connect/jdbc/system-requirements-for-the-jdbc-driver".
        <br />
        Gonilnik se doda kot zunanja knjižnica (mudul) tako da se naredi mapa:
        <code>[WILDFLY_HOME]/modules/com/microsoft/sqlserver/main</code>
        ter se vanj posname: sqljdbc[version].jar.
        Hkrati se v mapi doda datoteka z opisom modula <code>module.xml</code>
        z vsebino:
        <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;module xmlns="urn:jboss:module:1.1" name="com.oracle.jdbc">
   &lt;resources>
      &lt;resource-root path="sqljdbc[version].jar"/>
    &lt;/resources>
   &lt;dependencies>
     &lt;module name="javax.api"/>
     &lt;module name="javax.transaction.api"/>
     &lt;module name="javax.xml.bind.api"/>
     &lt;module name="javax.servlet.api" optional="true"/>
   &lt;/dependencies>
&lt;/module>
</code></pre><br /><br />

        Novi gonilnik se v konfiguracijski datoteki 'standalone-laurentius.xml' vključi tako, da se
        doda v razdelku <code>subsystem@xmlns="urn:jboss:domain:datasources:4.0"/drivers</code> nov razdelek 
        "driver"
        <pre><code> &lt;driver name="mssql" module="com.microsoft.sqlserver">
    &lt;driver-class>com.microsoft.sqlserver.jdbc.SQLServerDriver&lt;/driver-class>
&lt;/driver>
</code></pre>
        <br /><br />
        Dostop do baze se doda tako kot prikazujejo spodnje nastavitve. Za lastne nastavitve 
        popravi: connection-url, user-name in password.
        <pre><code>&lt;datasources>
  &lt;datasource jndi-name="java:jboss/datasources/ExampleDS" pool-name="ExampleDS" enabled="true" use-java-context="true">
    &lt;connection-url>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE&lt;/connection-url>
    &lt;driver>h2&lt;/driver>
    &lt;security>
      &lt;user-name>sa&lt;/user-name>
      &lt;password>sa&lt;/password>
    &lt;/security>
  &lt;/datasource>
  &lt;datasource jndi-name="java:/dsEBMS_SED" pool-name="ebMSSEDPool" enabled="true" use-java-context="true">
    &lt;connection-url>dbc:sqlserver://my.address.com\test:1433;databaseName=[mydbname]&lt;/connection-url>
    &lt;driver>mssql&lt;/driver>
    &lt;pool>
      &lt;min-pool-size>3&lt;/min-pool-size>
      &lt;max-pool-size>5&lt;/max-pool-size>
      &lt;prefill>true&lt;/prefill>
    &lt;/pool>
    &lt;security>
      &lt;user-name>lau&lt;/user-name>
      &lt;password>lau1234&lt;/password>
    &lt;/security>
  &lt;/datasource>
  &lt;drivers>
    &lt;driver name="h2" module="com.h2database.h2">
      &lt;xa-datasource-class>org.h2.jdbcx.JdbcDataSource&lt;/xa-datasource-class>
    &lt;/driver>
     &lt;driver name="mssql" module="com.microsoft.sqlserver">
        &lt;driver-class>com.microsoft.sqlserver.jdbc.SQLServerDriver&lt;/driver-class>
    &lt;/driver>
  &lt;/drivers>
&lt;/datasources></code></pre>


        <h1 id="install/database:db-cli">Primer namestitve z  CLI (command line interface)"</h1>
        Namestitev jdbc gonilnika in konfiguracija podatkovne povezava ne bazo 
        se lahko izdela tudi s pomočjo wildfly ukazne lupine: jboss-cli.(bat|sh).
        V nadaljevanju je primer namestitve Posgresql jdbc gonilnika in izdelava 
        podatkovne povezave na bazo. <br /><br />

        Pred izdelavo podatkovne povezave je potrebno izdelati "Management" uporabnika, ki ima pravico
        spreminjati konfiguracijo wildfly strežnika preko jboss-cli.(bat|sh) skripte.<br />



        <code>wildfly-10.1.0.Final/bin</code>določi wildfly admin uporabnika tako, da se požene skripto (in izbereš  userType: a) Management User):<br />
        <code>./add-user.(sh|bat)</code><br /><br />

        Nato poženi aplikacijski strežnik:<br />
        <code>./standalone.(sh|bat) -c standalone-laurentius.xml</code>

        Po končanem štartu strežnika zaženi CLI konzolo:  
        <code>./jboss-cli.sh  oz. ./jboss-cli.bat</code>
        V ukazno vrstico nato vpiši connect  in [enter]<br />

        Za namestitev ojdbc knjižnice prekopirajo ukaz in popravi pot in verzijo do posgresql knjižnice.:
        <pre><code>[standalone@localhost:9990 /] module add --name=org.postgres --resources=[potDoMapeZKnjiznico]/postgresql-x.x-x.jdbc42.jar --dependencies=javax.api,javax.transaction.api</code></pre>

        Nato določi ojdbc knjižnico
        <pre><code>[standalone@localhost:9990 /]/subsystem=datasources/jdbc-driver=postgres:add(driver-name="postgres",driver-module-name="org.postgres",driver-class-name=org.postgresql.Driver</code></pre>

        Nato določi povezavo na bazo:
        <pre><code>[standalone@localhost:9990 /]data-source add --jndi-name=java:/dsEBMS_SED --name=ebMSSEDPool --connection-url=jdbc:postgresql://localhost/db_sed --driver-name=postgres --user-name=[username] --password=[password]</code></pre>


    </article>  
</div>